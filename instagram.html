<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@rigatoni ‚Ä¢ Tonstergram</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #fafafa;
            padding-bottom: 60px;
        }
        
        /* Instagram Header */
        .instagram-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            border-bottom: 1px solid #dbdbdb;
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            height: 60px;
        }
        
        .instagram-logo {
            font-family: 'Brush Script MT', cursive;
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header-icons {
            display: flex;
            gap: 20px;
        }
        
        .header-icon {
            font-size: 24px;
            cursor: pointer;
        }
        
        /* Stories */
        .stories-container {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            background: white;
            border-bottom: 1px solid #dbdbdb;
            padding: 16px;
            display: flex;
            gap: 16px;
            overflow-x: auto;
            z-index: 999;
        }
        
        .story {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 80px;
        }
        
        .story-ring {
            width: 66px;
            height: 66px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            padding: 3px;
            cursor: pointer;
        }
        
        .story-avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid white;
            object-fit: cover;
        }
        
        .story-username {
            font-size: 12px;
            margin-top: 4px;
            text-align: center;
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* Feed */
        .feed {
            max-width: 614px;
            margin: 0 auto;
            padding-top: 160px;
        }
        
        /* Post */
        .post {
            background: white;
            border: 1px solid #dbdbdb;
            border-radius: 8px;
            margin-bottom: 24px;
        }
        
        .post-header {
            display: flex;
            align-items: center;
            padding: 14px 16px;
            gap: 12px;
        }
        
        .post-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .post-user-info {
            flex: 1;
        }
        
        .post-username {
            font-weight: 600;
            font-size: 14px;
        }
        
        .post-location {
            font-size: 12px;
            color: #8e8e8e;
        }
        
        .post-menu {
            font-size: 20px;
            cursor: pointer;
        }
        
        .post-image {
            width: 100%;
            max-height: 614px;
            object-fit: cover;
        }
        
        .post-actions {
            display: flex;
            padding: 8px 16px;
            gap: 16px;
            align-items: center;
        }
        
        .action-icon {
            font-size: 24px;
            cursor: pointer;
        }
        
        .action-icon.like {
            color: #ed4956;
        }
        
        .action-bookmark {
            margin-left: auto;
        }
        
        .post-likes {
            padding: 0 16px;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .post-caption {
            padding: 0 16px;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .post-username-caption {
            font-weight: 600;
            margin-right: 8px;
        }
        
        .post-comments {
            padding: 0 16px;
            font-size: 14px;
            color: #8e8e8e;
            margin-bottom: 8px;
        }
        
        .comment {
            margin-bottom: 4px;
        }
        
        .comment-username {
            font-weight: 600;
            color: #262626;
            margin-right: 8px;
        }
        
        .view-all-comments {
            color: #8e8e8e;
            cursor: pointer;
            margin-bottom: 8px;
        }
        
        .post-time {
            padding: 0 16px 12px;
            font-size: 10px;
            color: #8e8e8e;
            text-transform: uppercase;
        }
        
        .post-add-comment {
            border-top: 1px solid #efefef;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .comment-input {
            border: none;
            outline: none;
            flex: 1;
            font-size: 14px;
        }
        
        .post-button {
            color: #0095f6;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #dbdbdb;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
        }
        
        .nav-icon {
            font-size: 24px;
            cursor: pointer;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #8e8e8e;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #262626;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 640px) {
            .stories-container {
                padding: 8px;
            }
            
            .feed {
                padding-top: 140px;
            }
            
            .post {
                border-radius: 0;
                border-left: none;
                border-right: none;
                margin-bottom: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="instagram-header">
        <div class="instagram-logo">Tonstergram</div>
        <div class="header-icons">
            <span class="header-icon">‚ù§Ô∏è</span>
            <span class="header-icon">üí¨</span>
        </div>
    </div>
    
    <!-- Stories -->
    <div class="stories-container">
        <div class="story">
            <div class="story-ring">
                <div class="story-avatar" style="background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; font-size: 24px;">üò∏</div>
            </div>
            <div class="story-username">rigatoni</div>
        </div>
        <div class="story">
            <div class="story-ring">
                <div class="story-avatar" style="background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 24px;">üêæ</div>
            </div>
            <div class="story-username">catlife</div>
        </div>
        <div class="story">
            <div class="story-ring">
                <div class="story-avatar" style="background: #ffe0e0; display: flex; align-items: center; justify-content: center; font-size: 24px;">üòæ</div>
            </div>
            <div class="story-username">angryboi</div>
        </div>
        <div class="story">
            <div class="story-ring">
                <div class="story-avatar" style="background: #e0f0ff; display: flex; align-items: center; justify-content: center; font-size: 24px;">üòå</div>
            </div>
            <div class="story-username">zenmaster</div>
        </div>
        <div class="story">
            <div class="story-ring">
                <div class="story-avatar" style="background: #fff0e0; display: flex; align-items: center; justify-content: center; font-size: 24px;">üé©</div>
            </div>
            <div class="story-username">distinguished</div>
        </div>
    </div>
    
    <!-- Feed -->
    <div class="feed" id="feed">
        <!-- Posts will be dynamically generated here -->
    </div>
    
    <!-- Loading indicator -->
    <div class="loading" id="loading" style="display: none;">
        <div class="spinner"></div>
    </div>
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <span class="nav-icon">üè†</span>
        <span class="nav-icon">üîç</span>
        <span class="nav-icon">‚ûï</span>
        <span class="nav-icon">üé¨</span>
        <span class="nav-icon">üò∏</span>
    </div>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCdZpJL_uuutN-ucfaa_nZtuVAOII2csCg",
            authDomain: "toni-pet.firebaseapp.com",
            projectId: "toni-pet",
            storageBucket: "toni-pet.firebasestorage.app",
            messagingSenderId: "622524049665",
            appId: "1:622524049665:web:517998a212f53219845300",
            measurementId: "G-SHHD192VFD"
        };
        
        let db = null;
        let catPhotos = [];
        let usedPhotoIndices = [];
        let isLoading = false;
        
        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log("‚úÖ Firebase initialized");
        } catch (error) {
            console.log("Firebase initialization failed", error);
        }
        
        // Funny cat-themed usernames for comments
        const commentUsers = [
            "catmom_forever", "meow_meow_123", "purrfect_life", "whiskers_daily",
            "floof_master", "kitty_adventures", "toe_beans_fan", "cat_dad_life",
            "feline_fine", "crazy_cat_lady", "paw_patrol_real", "catnip_addict",
            "purrito_lover", "biscuit_maker", "void_screamer", "chonky_boi",
            "smol_bean", "angry_kitty", "zoomies_expert", "loaf_mode",
            "blep_queen", "mlem_king", "sploot_master", "monorail_cat"
        ];
        
        // Funny cat comments
        const commentTemplates = [
            "WHAT A DISTINGUISHED GENTLEMAN üé©",
            "The VOID stares back üëÅÔ∏è",
            "absolute unit",
            "Give him whatever he wants RIGHT NOW",
            "this is the ideal male body",
            "powerful energy",
            "he looks polite",
            "10/10 would pet",
            "not a single thought behind those eyes",
            "peak performance",
            "illegally smol",
            "r/airplaneears material",
            "MAXIMUM FLOOF ACHIEVED ‚òÅÔ∏è",
            "I would die for him",
            "He's beauty, he's grace...",
            "Those BEANS ü´ò",
            "No brain cells detected, full love mode",
            "cromch the snac",
            "he scream at own tail",
            "mood",
            "baby",
            "WHAT IS HE THINKING ABOUT???",
            "the most powerful being",
            "protecc at all costs",
            "I'm calling the police this is too cute",
            "ENHANCE THE WHISKERS",
            "chaotic energy detected",
            "zen master üßò",
            "judging us all",
            "This is what peak evolution looks like",
            "no thoughts, just vibes"
        ];
        
        // Captions for Toni (just meows!)
        const captionTemplates = [
            "meow",
            "meow meow",
            "meow meow meow",
            "meoooow",
            "meow meow meow meow",
            "mew",
            "mew mew mew",
            "meow mew meow",
            "meoooooow",
            "meow meow mew",
            "meow.",
            "meow meow.",
            "mrow",
            "mrow mrow",
            "meow mrow meow",
            "meeeow",
            "meow meow meow meow meow",
            "mew mew",
            "meow??",
            "meow meow meow.",
            "MEOW",
            "MEOW MEOW",
            "meow meow meow meow meow meow",
            "mrow meow",
            "meow....",
            "meow meow meow meow meow meow meow",
            "mew mew mew mew",
            "meow meow meow meow meow meow meow meow",
            "meow!",
            "meow meow!",
            "meow meow meow!",
            "mrowwww",
            "meow mew mew meow",
            "meooooooow"
        ];
        
        // Locations
        const locations = [
            "The Kingdom (aka Living Room)",
            "Royal Feeding Chamber",
            "The High Tower (Cat Tree)",
            "Forbidden Couch",
            "Window of Judgement",
            "The Void",
            "Cardboard Palace",
            "Under the Bed Realm",
            "Food Bowl Empire",
            "Sunbeam Spa",
            "The Great Beyond (Backyard)"
        ];
        
        // Load photos from Firestore
        async function loadPhotos() {
            if (!db) {
                console.log('Firestore not available, using fallback');
                return;
            }
            
            try {
                const snapshot = await db.collection('photos').get();
                catPhotos = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    catPhotos.push(data.path);
                });
                console.log(`‚úÖ Loaded ${catPhotos.length} photos from Firestore`);
                
                // Also load from localStorage as backup
                const savedPhotos = JSON.parse(localStorage.getItem('uploadedPhotos') || '[]');
                savedPhotos.forEach(photo => {
                    if (!catPhotos.includes(photo.path)) {
                        catPhotos.push(photo.path);
                    }
                });
                
                console.log(`‚úÖ Total photos available: ${catPhotos.length}`);
                
                if (catPhotos.length > 0) {
                    // Generate initial posts
                    for (let i = 0; i < 3; i++) {
                        generatePost();
                    }
                }
                
            } catch (error) {
                console.error('Error loading photos:', error);
            }
        }
        
        // Generate random number with weighted distribution toward higher values
        function getRandomLikes() {
            const ranges = [
                { min: 50000, max: 150000, weight: 5 },   // Super viral
                { min: 20000, max: 50000, weight: 15 },   // Very popular
                { min: 10000, max: 20000, weight: 30 },   // Popular
                { min: 5000, max: 10000, weight: 50 }     // Good engagement
            ];
            
            const totalWeight = ranges.reduce((sum, r) => sum + r.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (const range of ranges) {
                if (random < range.weight) {
                    return Math.floor(Math.random() * (range.max - range.min) + range.min);
                }
                random -= range.weight;
            }
            
            return 10000;
        }
        
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }
        
        function getRandomElement(array) {
            return array[Math.floor(Math.random() * array.length)];
        }
        
        function getRandomPhoto() {
            if (catPhotos.length === 0) return null;
            
            // If we've used all photos, reset
            if (usedPhotoIndices.length >= catPhotos.length) {
                usedPhotoIndices = [];
            }
            
            // Find unused photo
            let index;
            do {
                index = Math.floor(Math.random() * catPhotos.length);
            } while (usedPhotoIndices.includes(index));
            
            usedPhotoIndices.push(index);
            return catPhotos[index];
        }
        
        function getRandomTime() {
            const times = [
                "2 MINUTES AGO",
                "15 MINUTES AGO",
                "1 HOUR AGO",
                "3 HOURS AGO",
                "5 HOURS AGO",
                "1 DAY AGO",
                "2 DAYS AGO",
                "3 DAYS AGO",
                "1 WEEK AGO"
            ];
            return getRandomElement(times);
        }
        
        function generatePost() {
            const photoUrl = getRandomPhoto();
            if (!photoUrl) return;
            
            const likes = getRandomLikes();
            const commentCount = Math.floor(Math.random() * 500) + 100;
            const caption = getRandomElement(captionTemplates);
            const location = getRandomElement(locations);
            const time = getRandomTime();
            
            // Generate 2-3 visible comments
            const numComments = Math.floor(Math.random() * 2) + 2;
            const comments = [];
            for (let i = 0; i < numComments; i++) {
                comments.push({
                    username: getRandomElement(commentUsers),
                    text: getRandomElement(commentTemplates)
                });
            }
            
            const postHTML = `
                <div class="post">
                    <div class="post-header">
                        <div style="background: linear-gradient(135deg, #667eea, #764ba2); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px;">üò∏</div>
                        <div class="post-user-info">
                            <div class="post-username">rigatoni</div>
                            <div class="post-location">${location}</div>
                        </div>
                        <div class="post-menu">‚ãØ</div>
                    </div>
                    
                    <img src="${photoUrl}" alt="Toni" class="post-image">
                    
                    <div class="post-actions">
                        <span class="action-icon like">‚ù§Ô∏è</span>
                        <span class="action-icon">üí¨</span>
                        <span class="action-icon">üì§</span>
                        <span class="action-icon action-bookmark">üîñ</span>
                    </div>
                    
                    <div class="post-likes">
                        ${formatNumber(likes)} likes
                    </div>
                    
                    <div class="post-caption">
                        <span class="post-username-caption">rigatoni</span>
                        ${caption}
                    </div>
                    
                    <div class="post-comments">
                        <div class="view-all-comments">View all ${commentCount} comments</div>
                        ${comments.map(c => `
                            <div class="comment">
                                <span class="comment-username">${c.username}</span>
                                ${c.text}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="post-time">${time}</div>
                    
                    <div class="post-add-comment">
                        <span>üòä</span>
                        <input type="text" class="comment-input" placeholder="Add a comment...">
                        <span class="post-button">Post</span>
                    </div>
                </div>
            `;
            
            document.getElementById('feed').insertAdjacentHTML('beforeend', postHTML);
        }
        
        // Infinite scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting && !isLoading && catPhotos.length > 0) {
                    isLoading = true;
                    document.getElementById('loading').style.display = 'block';
                    
                    setTimeout(() => {
                        generatePost();
                        generatePost();
                        isLoading = false;
                        document.getElementById('loading').style.display = 'none';
                    }, 500);
                }
            });
        }, {
            threshold: 0.1
        });
        
        // Observe the loading element
        window.addEventListener('load', () => {
            observer.observe(document.getElementById('loading'));
            document.getElementById('loading').style.display = 'block';
        });
        
        // Initialize
        loadPhotos();
    </script>
</body>
</html>
